# de novo testing for k-mer selection
# samples involes in this process have coverage spans from 16~55

PHK46_B73v5.bam	16.5998
PHT11_B73v5.bam	18.8097
6M502_B73v5.bam	19.4788
PHT47_B73v5.bam	20.0882
N200_B73v5.bam	22.6543
B91_B73v5.bam	24.8481
29MIBZ2_B73v5.bam	26.2253
Seagull-Seventeen_B73v5.bam	27.6393
Va22_B73v5.bam	33.7964
B70_B73v5.bam	40.5048
W604S_B73v5.bam	47.1192
LH1_B73v5.bam	55.0503


while read p; do
  echo "s3cmd get s3://merged_bam_files_529/merge_bams/"$p""
done <12_bam_list.txt > 12_bam_file_download_cmd


#!/bin/bash
#SBATCH --time=1:00:00
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=12
#SBATCH --mem=120gb
#SBATCH --mail-type=ALL
#SBATCH --mail-user=qiuxx221@umn.edu
#SBATCH -o download_12_bam.out
#SBATCH -e download_12_bam.err
#SBATCH --tmp=350gb


module load parallel/20190122

cd /home/hirschc1/qiuxx221/widiv/de_novo/de_novo_assembly_test/12_bam_for_testing
parallel --tmpdir /home/hirschc1/qiuxx221/temp/ --jobs 12 < 12_bam_file_download_cmd


# extracting unmapped reads

#!/bin/bash
#SBATCH --time=12:00:00
#SBATCH --nodes=1
#SBATCH --ntasks-per-node=1
#SBATCH --cpus-per-task=4
#SBATCH --mem=20gb
#SBATCH --mail-type=ALL
#SBATCH --mail-user=qiuxx221@umn.edu
#SBATCH -o extract_unmapped.out
#SBATCH -e extract_unmapped.err
#SBATCH --tmp=100gb


cd /home/hirschc1/qiuxx221/widiv/de_novo/de_novo_assembly_test/12_bam_for_testing

module load samtools 

for i in *B73v5.bam; do 
  samtools view -f4 $i > $i.unmapped.sam
done 

for j in *.unmapped.sam; do 
  echo $j; 
  cat $j | grep -v ^@  | awk 'NR%2==1 {print "@"$1"\n"$10"\n+\n"$11}' > "$j"_1.fastq 
  cat $j | grep -v ^@  | awk 'NR%2==0 {print "@"$1"\n"$10"\n+\n"$11}' > "$j"_2.fastq
done 


# Trim adaptors again using trimomatic 
